<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—ñ–≤–µ–Ω—å 4: –•–º–∞—Ä–∏ —Ç–∞ –í–æ–ª–æ–≥—ñ—Å—Ç—å</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .game-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            text-align: center;
        }
        
        .game-title {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--accent-blue);
            text-shadow: 0 2px 10px rgba(66, 135, 245, 0.4);
        }
        
        .game-subtitle {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 30px;
            color: var(--text-secondary);
        }
        
        .humidity-game {
            background: var(--glass-bg);
            border-radius: 25px;
            padding: 30px;
            border: 3px solid var(--accent-blue);
            box-shadow: 0 10px 40px rgba(66, 135, 245, 0.2);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .sky-container {
            height: 300px;
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
            border-radius: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            box-shadow: 0 10px 20px rgba(255, 255, 255, 0.8);
            opacity: 0.9;
            transition: all 0.5s ease;
        }
        
        .cloud-small {
            width: 80px;
            height: 40px;
        }
        
        .cloud-medium {
            width: 120px;
            height: 60px;
        }
        
        .cloud-large {
            width: 160px;
            height: 80px;
        }
        
        .humidity-meter {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 400px;
            border: 2px solid var(--accent-blue);
        }
        
        .humidity-value {
            font-size: 48px;
            font-weight: 900;
            color: var(--accent-blue);
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(66, 135, 245, 0.5);
        }
        
        .humidity-label {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            height: 30px;
            margin: 25px 0;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4287f5, #42b4f5);
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            font-size: 14px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #4287f5, #42b4f5);
            border: none;
            width: 140px;
            height: 140px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 900;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 10px 30px rgba(66, 135, 245, 0.4),
                inset 0 5px 15px rgba(255, 255, 255, 0.3);
        }
        
        .control-btn:hover {
            transform: scale(1.05);
            box-shadow: 
                0 15px 40px rgba(66, 135, 245, 0.6),
                inset 0 5px 15px rgba(255, 255, 255, 0.4);
        }
        
        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 
                0 5px 20px rgba(66, 135, 245, 0.3),
                inset 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .control-btn i {
            font-size: 50px;
            margin-bottom: 15px;
        }
        
        .temp-btn {
            background: linear-gradient(45deg, #f54242, #f5a742);
        }
        
        .temp-btn:hover {
            box-shadow: 
                0 15px 40px rgba(245, 66, 66, 0.6),
                inset 0 5px 15px rgba(255, 255, 255, 0.4);
        }
        
        .condensation-btn {
            background: linear-gradient(45deg, #42f563, #42f5e3);
        }
        
        .condensation-btn:hover {
            box-shadow: 
                0 15px 40px rgba(66, 245, 99, 0.6),
                inset 0 5px 15px rgba(255, 255, 255, 0.4);
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-blue);
        }
        
        .instructions h3 {
            color: var(--accent-blue);
            margin-bottom: 10px;
        }
        
        .instructions p {
            margin-bottom: 10px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .cloud-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .cloud-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s;
        }
        
        .cloud-card.active {
            background: rgba(66, 135, 245, 0.2);
            border-color: var(--accent-blue);
            transform: translateY(-5px);
        }
        
        .cloud-icon {
            font-size: 36px;
            margin-bottom: 10px;
            color: white;
        }
        
        .cloud-name {
            font-weight: 900;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .cloud-desc {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.3;
        }
        
        .humidity-required {
            font-size: 12px;
            color: var(--accent-lime);
            margin-top: 5px;
        }
        
        .result-screen {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .result-emoji {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .result-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--accent-blue);
            margin: 20px 0;
        }
        
        .stars {
            font-size: 36px;
            color: gold;
            margin: 20px 0;
        }
        
        .completion-message {
            font-size: 18px;
            margin: 20px 0;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* –ê–Ω—ñ–º–∞—Ü—ñ—ó –¥–ª—è —Ö–º–∞—Ä */
        @keyframes floatCloud {
            0% { transform: translateX(-200px); }
            100% { transform: translateX(1000px); }
        }
        
        @keyframes rain {
            0% { transform: translateY(-10px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(50px); opacity: 0; }
        }
        
        .rain-drop {
            position: absolute;
            width: 2px;
            height: 15px;
            background: linear-gradient(to bottom, transparent, #4287f5);
            opacity: 0;
        }
        
        .info-panel {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
        }
        
        .info-item {
            text-align: center;
            flex: 1;
        }
        
        .info-value {
            font-size: 24px;
            font-weight: 900;
            color: var(--accent-blue);
            margin-bottom: 5px;
        }
        
        .info-label {
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <header class="game-header">
        <div class="header-left">
            <a href="../game.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div class="player-info">
                <div class="username">‚òÅÔ∏è –•–º–∞—Ä–∏ —Ç–∞ –í–æ–ª–æ–≥—ñ—Å—Ç—å</div>
                <div class="player-class">–†—ñ–≤–µ–Ω—å 4</div>
            </div>
        </div>
        <div class="stats">
            <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span id="timer-display">02:00</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-tint"></i>
                <span id="humidity-display">50%</span>
            </div>
        </div>
    </header>
    
    <main class="game-container">
        <h1 class="game-title">üåßÔ∏è –ó–∞–≤–¥–∞–Ω–Ω—è: –°—Ç–≤–æ—Ä–∏ —Ö–º–∞—Ä–∏ —Ç–∞ –¥–æ—â!</h1>
        <p class="game-subtitle">–ö–æ–Ω—Ç—Ä–æ–ª—é–π –≤–æ–ª–æ–≥—ñ—Å—Ç—å —Ç–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, —â–æ–± —É—Ç–≤–æ—Ä–∏—Ç–∏ —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ —Ö–º–∞—Ä</p>
        
        <div class="humidity-game">
            <!-- –ù–µ–±–µ—Å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
            <div class="sky-container" id="sky-container">
                <!-- –•–º–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—è —Ç—É—Ç -->
            </div>
            
            <!-- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–æ–ª–æ–≥–æ—Å—Ç—ñ -->
            <div class="humidity-meter">
                <div class="humidity-label">–í–Ü–î–ù–û–°–ù–ê –í–û–õ–û–ì–Ü–°–¢–¨</div>
                <div class="humidity-value" id="humidity-value">50%</div>
                <div class="humidity-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: <span id="temperature-value">20¬∞C</span></div>
            </div>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å -->
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%;">
                    <div class="progress-text" id="progress-text">0%</div>
                </div>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó -->
            <div class="info-panel">
                <div class="info-item">
                    <div class="info-value" id="cloud-count">0</div>
                    <div class="info-label">–•–ú–ê–†–ò</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="cloud-type">-</div>
                    <div class="info-label">–¢–ò–ü –•–ú–ê–†–ò</div>
                </div>
                <div class="info-item">
                    <div class="info-value" id="points">0</div>
                    <div class="info-label">–ë–ê–õ–ò</div>
                </div>
            </div>
            
            <!-- –ï–ª–µ–º–µ–Ω—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
            <div class="controls">
                <button class="control-btn" id="add-humidity-btn" onclick="addHumidity()">
                    <i class="fas fa-tint"></i>
                    –î–æ–¥–∞—Ç–∏ –≤–æ–ª–æ–≥–æ—Å—Ç—ñ
                </button>
                
                <button class="control-btn temp-btn" id="change-temp-btn" onclick="changeTemperature()">
                    <i class="fas fa-thermometer-half"></i>
                    –ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
                </button>
                
                <button class="control-btn condensation-btn" id="condensation-btn" onclick="triggerCondensation()">
                    <i class="fas fa-cloud-rain"></i>
                    –ö–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—è
                </button>
            </div>
            
            <!-- –¢–∏–ø–∏ —Ö–º–∞—Ä -->
            <div class="cloud-types">
                <div class="cloud-card" id="cloud-cumulus">
                    <div class="cloud-icon">‚òÅÔ∏è</div>
                    <div class="cloud-name">–ö—É–º—É–ª—é—Å</div>
                    <div class="cloud-desc">–ü—É—Ö–Ω–∞—Å—Ç—ñ –±—ñ–ª—ñ —Ö–º–∞—Ä–∏, –≥–∞—Ä–Ω–∞ –ø–æ–≥–æ–¥–∞</div>
                    <div class="humidity-required">–í–æ–ª–æ–≥—ñ—Å—Ç—å: 60-70%</div>
                </div>
                
                <div class="cloud-card" id="cloud-stratus">
                    <div class="cloud-icon">üå´Ô∏è</div>
                    <div class="cloud-name">–°—Ç—Ä–∞—Ç—É—Å</div>
                    <div class="cloud-desc">–†—ñ–≤–Ω–∏–π —à–∞—Ä —Ö–º–∞—Ä, –ø–æ—Ö–º—É—Ä–∞ –ø–æ–≥–æ–¥–∞</div>
                    <div class="humidity-required">–í–æ–ª–æ–≥—ñ—Å—Ç—å: 80-90%</div>
                </div>
                
                <div class="cloud-card" id="cloud-nimbus">
                    <div class="cloud-icon">üåßÔ∏è</div>
                    <div class="cloud-name">–ù—ñ–º–±—É—Å</div>
                    <div class="cloud-desc">–î–æ—â–æ–≤—ñ —Ö–º–∞—Ä–∏, —Å–∏–ª—å–Ω—ñ –æ–ø–∞–¥–∏</div>
                    <div class="humidity-required">–í–æ–ª–æ–≥—ñ—Å—Ç—å: 95-100%</div>
                </div>
            </div>
            
            <!-- –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó -->
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> –Ø–∫ –≥—Ä–∞—Ç–∏:</h3>
                <p>1. –î–æ–¥–∞–≤–∞–π –≤–æ–ª–æ–≥—ñ—Å—Ç—å, —â–æ–± –∑–±—ñ–ª—å—à–∏—Ç–∏ –≤—ñ–¥—Å–æ—Ç–æ–∫ –≤–æ–ª–æ–≥–æ—Å—Ç—ñ –≤ –ø–æ–≤—ñ—Ç—Ä—ñ</p>
                <p>2. –†–µ–≥—É–ª—é–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —É–º–æ–≤ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—ó</p>
                <p>3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∫–Ω–æ–ø–∫—É "–ö–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—è" –¥–ª—è —É—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ö–º–∞—Ä</p>
                <p>4. –°—Ç–≤–æ—Ä–∏ –≤—Å—ñ 3 —Ç–∏–ø–∏ —Ö–º–∞—Ä: <strong>–ö—É–º—É–ª—é—Å, –°—Ç—Ä–∞—Ç—É—Å —Ç–∞ –ù—ñ–º–±—É—Å</strong></p>
                <p><strong>–¶—ñ–ª—å: –î–æ—Å—è–≥—Ç–∏ 100% –≤–æ–ª–æ–≥–æ—Å—Ç—ñ —Ç–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ—â!</strong></p>
            </div>
        </div>
        
        <!-- –ï–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ -->
        <div id="result-screen" class="result-screen">
            <div class="result-emoji" id="result-emoji">‚õàÔ∏è</div>
            <h2 id="result-title">–†–µ–∑—É–ª—å—Ç–∞—Ç!</h2>
            
            <div class="completion-message" id="completion-message">
                –¢–∏ —Å—Ç–≤–æ—Ä–∏–≤ <span id="final-clouds">0</span> —Ö–º–∞—Ä —Ç–∞ –Ω–∞–±—Ä–∞–≤ <span id="final-points">0</span> –±–∞–ª—ñ–≤!
            </div>
            
            <div class="result-score" id="final-score">0 –±–∞–ª—ñ–≤</div>
            
            <div class="stars" id="stars-display">‚òÜ‚òÜ‚òÜ</div>
            
            <div class="completion-message">
                –ü—Ä–æ—Ü–µ—Å —É—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ö–º–∞—Ä:<br>
                <strong>–í–∏–ø–∞—Ä–æ–≤—É–≤–∞–Ω–Ω—è ‚Üí –ö–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—è ‚Üí –£—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ö–º–∞—Ä–∏ ‚Üí –û–ø–∞–¥–∏</strong>
            </div>
            
            <div style="margin-top: 40px;">
                <button class="btn-primary" onclick="finishLevel()" style="padding: 15px 40px; font-size: 20px;">
                    <i class="fas fa-trophy"></i> –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å
                </button>
            </div>
        </div>
    </main>
    
    <script>
        // ============ –ó–ú–Ü–ù–ù–Ü –ì–†–ò ============
        let humidity = 50;      // –ü–æ—á–∞—Ç–∫–æ–≤–∞ –≤–æ–ª–æ–≥—ñ—Å—Ç—å (%)
        let temperature = 20;   // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)
        let clouds = [];        // –ú–∞—Å–∏–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö —Ö–º–∞—Ä
        let cloudCount = 0;     // –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ö–º–∞—Ä
        let points = 0;         // –ë–∞–ª–∏
        let progress = 0;       // –ü—Ä–æ–≥—Ä–µ—Å (0-100%)
        let timeLeft = 120;     // –ß–∞—Å —É —Å–µ–∫—É–Ω–¥–∞—Ö (2 —Ö–≤–∏–ª–∏–Ω–∏)
        let timerInterval;
        let gameCompleted = false;
        
        // –¢–∏–ø–∏ —Ö–º–∞—Ä —Ç–∞ —ó—Ö –≤–∏–º–æ–≥–∏
        const CLOUD_TYPES = {
            CUMULUS: { name: "–ö—É–º—É–ª—é—Å", humidity: 65, temp: 15, points: 4, icon: "‚òÅÔ∏è" },
            STRATUS: { name: "–°—Ç—Ä–∞—Ç—É—Å", humidity: 85, temp: 10, points: 6, icon: "üå´Ô∏è" },
            NIMBUS: { name: "–ù—ñ–º–±—É—Å", humidity: 95, temp: 5, points: 8, icon: "üåßÔ∏è" }
        };
        
        let createdCloudTypes = []; // –¢–∏–ø–∏ —Ö–º–∞—Ä, —è–∫—ñ –≤–∂–µ —Å—Ç–≤–æ—Ä–µ–Ω—ñ
        
        // ============ –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ============
        function initGame() {
            updateDisplay();
            startTimer();
            createInitialClouds();
        }
        
        // ============ –¢–ê–ô–ú–ï–† ============
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimeDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    if (!gameCompleted) {
                        finishGame();
                    }
                }
            }, 1000);
        }
        
        // ============ –°–¢–í–û–†–ï–ù–ù–Ø –ü–û–ß–ê–¢–ö–û–í–ò–• –•–ú–ê–† ============
        function createInitialClouds() {
            const sky = document.getElementById('sky-container');
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –¥–µ–∫—ñ–ª—å–∫–∞ —Ñ–æ–Ω–æ–≤–∏—Ö —Ö–º–∞—Ä
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    createCloud('background', i * 100, 50 + i * 30);
                }, i * 500);
            }
        }
        
        // ============ –î–û–î–ê–í–ê–ù–ù–Ø –í–û–õ–û–ì–û–°–¢–Ü ============
        function addHumidity() {
            if (gameCompleted) return;
            
            // –ó–±—ñ–ª—å—à—É—î–º–æ –≤–æ–ª–æ–≥—ñ—Å—Ç—å
            humidity = Math.min(humidity + 8, 100);
            
            // –î–æ–¥–∞—î–º–æ –±–∞–ª–∏
            points += 1;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å
            progress = Math.min((humidity / 100) * 50 + (cloudCount * 10), 100);
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –∫–Ω–æ–ø–∫–∏
            animateButton('add-humidity-btn');
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –µ—Ñ–µ–∫—Ç –∫—Ä–∞–ø–µ–ª—å
            createHumidityEffect();
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            updateDisplay();
        }
        
        // ============ –ó–ú–Ü–ù–ê –¢–ï–ú–ü–ï–†–ê–¢–£–†–ò ============
        function changeTemperature() {
            if (gameCompleted) return;
            
            // –ó–º—ñ–Ω—é—î–º–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É (–≤–∏–ø–∞–¥–∫–æ–≤–µ –∑–Ω–∏–∂–µ–Ω–Ω—è)
            temperature -= Math.floor(Math.random() * 5) + 1;
            if (temperature < -5) temperature = -5; // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
            
            // –î–æ–¥–∞—î–º–æ –±–∞–ª–∏
            points += 1;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å
            progress = Math.min((humidity / 100) * 50 + (cloudCount * 10), 100);
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –∫–Ω–æ–ø–∫–∏
            animateButton('change-temp-btn');
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ö–º–∞—Ä—É
            checkCloudCreation();
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            updateDisplay();
        }
        
        // ============ –ö–û–ù–î–ï–ù–°–ê–¶–Ü–Ø ============
        function triggerCondensation() {
            if (gameCompleted) return;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —É–º–æ–≤–∏ –¥–ª—è –∫–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—ó
            if (humidity >= 60 && temperature <= 15) {
                // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ç–∏–ø —Ö–º–∞—Ä–∏, —è–∫–∏–π –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏
                let cloudToCreate = null;
                
                if (humidity >= CLOUD_TYPES.NIMBUS.humidity && temperature <= CLOUD_TYPES.NIMBUS.temp) {
                    cloudToCreate = CLOUD_TYPES.NIMBUS;
                } else if (humidity >= CLOUD_TYPES.STRATUS.humidity && temperature <= CLOUD_TYPES.STRATUS.temp) {
                    cloudToCreate = CLOUD_TYPES.STRATUS;
                } else if (humidity >= CLOUD_TYPES.CUMULUS.humidity && temperature <= CLOUD_TYPES.CUMULUS.temp) {
                    cloudToCreate = CLOUD_TYPES.CUMULUS;
                }
                
                // –Ø–∫—â–æ –∑–Ω–∞–π—à–ª–∏ –ø—ñ–¥—Ö–æ–¥—è—â–∏–π —Ç–∏–ø —Ö–º–∞—Ä–∏
                if (cloudToCreate && !createdCloudTypes.includes(cloudToCreate.name)) {
                    // –°—Ç–≤–æ—Ä—é—î–º–æ —Ö–º–∞—Ä—É
                    createCloud(cloudToCreate.name, Math.random() * 600, 100 + Math.random() * 100);
                    
                    // –î–æ–¥–∞—î–º–æ —Ç–∏–ø —Ö–º–∞—Ä–∏ –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö
                    createdCloudTypes.push(cloudToCreate.name);
                    
                    // –î–æ–¥–∞—î–º–æ –±–∞–ª–∏
                    points += cloudToCreate.points;
                    cloudCount++;
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å
                    progress = Math.min((humidity / 100) * 50 + (cloudCount * 15), 100);
                    
                    // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ –∫–∞—Ä—Ç–∫—É —Ö–º–∞—Ä–∏
                    highlightCloudCard(cloudToCreate.name);
                    
                    // –Ø–∫—â–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ –≤—Å—ñ —Ç–∏–ø–∏ —Ö–º–∞—Ä
                    if (createdCloudTypes.length >= 3) {
                        progress = 100;
                        setTimeout(() => {
                            gameCompleted = true;
                            clearInterval(timerInterval);
                            finishGame();
                        }, 1000);
                    }
                }
            } else {
                // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –Ω–µ–≤–¥–∞–ª—É —Å–ø—Ä–æ–±—É
                showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –≤–æ–ª–æ–≥—ñ—Å—Ç—å –∞–±–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∑–∞–Ω–∞–¥—Ç–æ –≤–∏—Å–æ–∫–∞!");
            }
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –∫–Ω–æ–ø–∫–∏
            animateButton('condensation-btn');
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            updateDisplay();
        }
        
        // ============ –°–¢–í–û–†–ï–ù–ù–Ø –•–ú–ê–†–ò ============
        function createCloud(type, x, y) {
            const sky = document.getElementById('sky-container');
            
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞ —Ç–∏–ø–æ–º
            if (type === 'background') {
                cloud.classList.add('cloud-small');
                cloud.style.background = 'rgba(255, 255, 255, 0.6)';
                cloud.style.opacity = '0.7';
            } else {
                // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ä–æ–∑–º—ñ—Ä –∑–∞ —Ç–∏–ø–æ–º —Ö–º–∞—Ä–∏
                if (type === CLOUD_TYPES.CUMULUS.name) {
                    cloud.classList.add('cloud-medium');
                    cloud.style.background = 'white';
                } else if (type === CLOUD_TYPES.STRATUS.name) {
                    cloud.classList.add('cloud-large');
                    cloud.style.background = 'rgba(200, 200, 200, 0.9)';
                } else if (type === CLOUD_TYPES.NIMBUS.name) {
                    cloud.classList.add('cloud-large');
                    cloud.style.background = 'rgba(100, 100, 120, 0.9)';
                    // –î–æ–¥–∞—î–º–æ –¥–æ—â –¥–æ –Ω—ñ–º–±—É—Å–∞
                    setTimeout(() => createRain(x, y), 500);
                }
                
                // –î–æ–¥–∞—î–º–æ —Ç–µ–∫—Å—Ç –∑ —Ç–∏–ø–æ–º —Ö–º–∞—Ä–∏
                const cloudText = document.createElement('div');
                cloudText.textContent = type;
                cloudText.style.position = 'absolute';
                cloudText.style.bottom = '-25px';
                cloudText.style.left = '0';
                cloudText.style.right = '0';
                cloudText.style.textAlign = 'center';
                cloudText.style.fontSize = '12px';
                cloudText.style.fontWeight = 'bold';
                cloudText.style.color = 'white';
                cloudText.style.textShadow = '0 1px 3px rgba(0,0,0,0.5)';
                cloud.appendChild(cloudText);
            }
            
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é
            cloud.style.left = `${x}px`;
            cloud.style.top = `${y}px`;
            
            // –î–æ–¥–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é —Ä—É—Ö—É
            if (type === 'background') {
                const duration = 60 + Math.random() * 60;
                cloud.style.animation = `floatCloud ${duration}s linear infinite`;
            } else {
                // –ê–Ω—ñ–º–∞—Ü—ñ—è –∑'—è–≤–ª–µ–Ω–Ω—è
                cloud.style.transform = 'scale(0)';
                setTimeout(() => {
                    cloud.style.transition = 'transform 1s ease';
                    cloud.style.transform = 'scale(1)';
                }, 100);
            }
            
            sky.appendChild(cloud);
            clouds.push(cloud);
            
            // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ö–º–∞—Ä—É –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
            return cloud;
        }
        
        // ============ –°–¢–í–û–†–ï–ù–ù–Ø –î–û–©–£ ============
        function createRain(x, y) {
            const sky = document.getElementById('sky-container');
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –∫—ñ–ª—å–∫–∞ –∫—Ä–∞–ø–µ–ª—å –¥–æ—â—É
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const drop = document.createElement('div');
                    drop.className = 'rain-drop';
                    drop.style.left = `${x + 40 + Math.random() * 80}px`;
                    drop.style.top = `${y + 80}px`;
                    drop.style.animation = `rain ${0.5 + Math.random() * 0.5}s linear forwards`;
                    drop.style.animationDelay = `${Math.random() * 0.5}s`;
                    
                    sky.appendChild(drop);
                    
                    // –í–∏–¥–∞–ª—è—î–º–æ –∫—Ä–∞–ø–ª—é –ø—ñ—Å–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
                    setTimeout(() => {
                        if (drop.parentNode) {
                            drop.parentNode.removeChild(drop);
                        }
                    }, 2000);
                }, i * 100);
            }
        }
        
        // ============ –ü–ï–†–ï–í–Ü–†–ö–ê –°–¢–í–û–†–ï–ù–ù–Ø –•–ú–ê–†–ò ============
        function checkCloudCreation() {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î–º–æ —Ö–º–∞—Ä–∏ –ø—Ä–∏ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—ñ —É–º–æ–≤
            if (!createdCloudTypes.includes(CLOUD_TYPES.CUMULUS.name) && 
                humidity >= CLOUD_TYPES.CUMULUS.humidity && 
                temperature <= CLOUD_TYPES.CUMULUS.temp) {
                
                setTimeout(() => {
                    if (!gameCompleted) {
                        showMessage(`–£—Ç–≤–æ—Ä–∏–ª–∞—Å—è —Ö–º–∞—Ä–∞: ${CLOUD_TYPES.CUMULUS.name}!`);
                        createCloud(CLOUD_TYPES.CUMULUS.name, 100 + Math.random() * 400, 120);
                        createdCloudTypes.push(CLOUD_TYPES.CUMULUS.name);
                        points += CLOUD_TYPES.CUMULUS.points;
                        cloudCount++;
                        highlightCloudCard(CLOUD_TYPES.CUMULUS.name);
                        updateDisplay();
                    }
                }, 500);
            }
        }
        
        // ============ –ü–Ü–î–°–í–Ü–¢–õ–ï–ù–ù–Ø –ö–ê–†–¢–ö–ò –•–ú–ê–†–ò ============
        function highlightCloudCard(cloudName) {
            const cardId = `cloud-${cloudName.toLowerCase()}`;
            const card = document.getElementById(cardId);
            
            if (card) {
                card.classList.add('active');
                
                // –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –ø—ñ–¥—Å–≤—ñ—Ç–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(() => {
                    card.classList.remove('active');
                }, 3000);
            }
        }
        
        // ============ –ê–ù–Ü–ú–ê–¶–Ü–Ø –ö–ù–û–ü–ö–ò ============
        function animateButton(buttonId) {
            const button = document.getElementById(buttonId);
            
            button.style.animation = 'pump 0.3s';
            setTimeout(() => {
                button.style.animation = '';
            }, 300);
        }
        
        // ============ –ï–§–ï–ö–¢ –í–û–õ–û–ì–û–°–¢–Ü ============
        function createHumidityEffect() {
            const sky = document.getElementById('sky-container');
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –µ—Ñ–µ–∫—Ç –≤–∏–ø–∞—Ä–æ–≤—É–≤–∞–Ω–Ω—è
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.style.cssText = `
                        position: absolute;
                        width: 10px;
                        height: 10px;
                        background: radial-gradient(circle, rgba(66, 135, 245, 0.8), rgba(66, 180, 245, 0.4));
                        border-radius: 50%;
                        bottom: 10px;
                        left: ${100 + Math.random() * 600}px;
                        opacity: 0.8;
                        animation: bubbleUp 2s ease-out forwards;
                    `;
                    
                    sky.appendChild(bubble);
                    
                    // –í–∏–¥–∞–ª—è—î–º–æ –±—É–ª—å–±–∞—à–∫—É –ø—ñ—Å–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 2000);
                }, i * 100);
            }
            
            // –î–æ–¥–∞—î–º–æ —Å—Ç–∏–ª—å –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –±—É–ª—å–±–∞—à–æ–∫
            if (!document.getElementById('bubble-style')) {
                const style = document.createElement('style');
                style.id = 'bubble-style';
                style.textContent = `
                    @keyframes bubbleUp {
                        0% {
                            transform: translateY(0) scale(1);
                            opacity: 0.8;
                        }
                        100% {
                            transform: translateY(-150px) scale(0.5);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // ============ –ü–û–ö–ê–ó –ü–û–í–Ü–î–û–ú–õ–ï–ù–¨ ============
        function showMessage(text) {
            // –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            const message = document.createElement('div');
            message.textContent = text;
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 10000;
                font-weight: bold;
                border: 2px solid var(--accent-blue);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
                animation: fadeInOut 2s forwards;
            `;
            
            document.body.appendChild(message);
            
            // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 2000);
            
            // –î–æ–¥–∞—î–º–æ —Å—Ç–∏–ª—å –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
            if (!document.getElementById('message-style')) {
                const style = document.createElement('style');
                style.id = 'message-style';
                style.textContent = `
                    @keyframes fadeInOut {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                        20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // ============ –û–ù–û–í–õ–ï–ù–ù–Ø –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø ============
        function updateDisplay() {
            // –í–æ–ª–æ–≥—ñ—Å—Ç—å
            document.getElementById('humidity-value').textContent = 
                `${Math.round(humidity)}%`;
            document.getElementById('humidity-display').textContent = 
                `${Math.round(humidity)}%`;
            
            // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
            document.getElementById('temperature-value').textContent = 
                `${temperature}¬∞C`;
            
            // –ü—Ä–æ–≥—Ä–µ—Å
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = 
                `${Math.round(progress)}%`;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('cloud-count').textContent = cloudCount;
            document.getElementById('points').textContent = points;
            
            // –¢–∏–ø —Ö–º–∞—Ä–∏
            let currentCloudType = '-';
            if (humidity >= CLOUD_TYPES.NIMBUS.humidity) {
                currentCloudType = CLOUD_TYPES.NIMBUS.name;
            } else if (humidity >= CLOUD_TYPES.STRATUS.humidity) {
                currentCloudType = CLOUD_TYPES.STRATUS.name;
            } else if (humidity >= CLOUD_TYPES.CUMULUS.humidity) {
                currentCloudType = CLOUD_TYPES.CUMULUS.name;
            }
            document.getElementById('cloud-type').textContent = currentCloudType;
            
            // –ß–∞—Å
            updateTimeDisplay();
        }
        
        function updateTimeDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer-display').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // ============ –ó–ê–í–ï–†–®–ï–ù–ù–Ø –ì–†–ò ============
        function finishGame() {
            gameCompleted = true;
            clearInterval(timerInterval);
            
            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —ñ–≥—Ä–æ–≤—É –∑–æ–Ω—É
            document.querySelector('.humidity-game').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –µ–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
            const resultScreen = document.getElementById('result-screen');
            resultScreen.style.display = 'block';
            
            // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –±–∞–ª–∏
            let score = points;
            let stars = 0;
            let emoji = '‚òÅÔ∏è';
            let title = '–ú–æ–∂–Ω–∞ –∫—Ä–∞—â–µ!';
            let message = '';
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∑—ñ—Ä–∫–∏
            if (createdCloudTypes.length >= 3) {
                if (score >= 30) {
                    stars = 3;
                    emoji = '‚õàÔ∏è';
                    title = '–í—ñ–¥–º—ñ–Ω–Ω–æ!';
                    message = '–¢–∏ –º–∞–π—Å—Ç–µ—Ä —Ö–º–∞—Ä–æ—Ç–≤–æ—Ä–µ–Ω–Ω—è!';
                } else if (score >= 20) {
                    stars = 2;
                    emoji = 'üåßÔ∏è';
                    title = '–î–æ–±—Ä–µ!';
                    message = '–ß—É–¥–æ–≤–æ –≤–ø–æ—Ä–∞–≤—Å—è –∑ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—î—é!';
                } else {
                    stars = 1;
                    emoji = 'üå´Ô∏è';
                    title = '–ù–µ–ø–æ–≥–∞–Ω–æ!';
                    message = '–¢–∏ —Å—Ç–≤–æ—Ä–∏–≤ –≤—Å—ñ —Ç–∏–ø–∏ —Ö–º–∞—Ä!';
                }
            } else if (createdCloudTypes.length >= 2) {
                stars = 1;
                emoji = '‚òÅÔ∏è';
                title = '–ù–µ–ø–æ–≥–∞–Ω–æ!';
                message = '–¢–∏ —Å—Ç–≤–æ—Ä–∏–≤ 2 —Ç–∏–ø–∏ —Ö–º–∞—Ä!';
            } else {
                stars = 0;
                emoji = 'üå§Ô∏è';
                title = '–°–ø—Ä–æ–±—É–π —â–µ!';
                message = '–ü–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ –≤–æ–ª–æ–≥–æ—Å—Ç—ñ!';
            }
            
            // –ú–∞–∫—Å–∏–º—É–º 12 –±–∞–ª—ñ–≤ –∑–∞ —Ä—ñ–≤–µ–Ω—å
            score = Math.min(score, 12);
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –µ–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
            document.getElementById('result-emoji').textContent = emoji;
            document.getElementById('result-title').textContent = title;
            document.getElementById('completion-message').innerHTML = 
                `–¢–∏ —Å—Ç–≤–æ—Ä–∏–≤ <span id="final-clouds">${createdCloudTypes.length}</span> —Ö–º–∞—Ä —Ç–∞ –Ω–∞–±—Ä–∞–≤ <span id="final-points">${points}</span> –±–∞–ª—ñ–≤!<br>${message}`;
            document.getElementById('final-score').textContent = `${score} –±–∞–ª—ñ–≤`;
            
            // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –∑—ñ—Ä–∫–∏
            let starsHTML = '';
            for (let i = 0; i < 3; i++) {
                starsHTML += i < stars ? '‚òÖ' : '‚òÜ';
            }
            document.getElementById('stars-display').innerHTML = starsHTML;
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
            saveResults(score, stars);
        }
        
        // ============ –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í ============
        function saveResults(score, stars) {
            localStorage.setItem('level4_score', score);
            localStorage.setItem('level4_stars', stars);
            localStorage.setItem('level4_completed', 'true');
            
            console.log(`–†—ñ–≤–µ–Ω—å 4 –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${score} –±–∞–ª—ñ–≤, ${stars} –∑—ñ—Ä–æ–∫`);
        }
        
        // ============ –ó–ê–í–ï–†–®–ï–ù–ù–Ø –†–Ü–í–ù–Ø ============
        function finishLevel() {
            const score = parseInt(localStorage.getItem('level4_score')) || 0;
            const stars = parseInt(localStorage.getItem('level4_stars')) || 0;
            
            window.location.href = `../game.html?level=4&score=${score}&stars=${stars}`;
        }
        
        // ============ –ó–ê–ü–£–°–ö –ì–†–ò ============
        document.addEventListener('DOMContentLoaded', initGame);
        
        // –î–æ–¥–∞—î–º–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏ –∫–ª–∞–≤—ñ—à—ñ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è
        document.addEventListener('keydown', (e) => {
            if (gameCompleted) return;
            
            switch(e.key) {
                case '1':
                    e.preventDefault();
                    addHumidity();
                    break;
                case '2':
                    e.preventDefault();
                    changeTemperature();
                    break;
                case '3':
                case ' ':
                    e.preventDefault();
                    triggerCondensation();
                    break;
            }
        });
        
        // –î–æ–¥–∞—î–º–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ç–∞–ø—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ id –∫–Ω–æ–ø–∫–∏
                if (btn.id === 'add-humidity-btn') addHumidity();
                else if (btn.id === 'change-temp-btn') changeTemperature();
                else if (btn.id === 'condensation-btn') triggerCondensation();
            });
        });
    </script>
</body>
</html>
