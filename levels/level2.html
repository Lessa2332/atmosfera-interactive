<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—ñ–≤–µ–Ω—å 5: –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ñ –æ–ø–∞–¥–∏</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .game-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            text-align: center;
        }

        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 30px auto;
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                #FF9500 0% 20%,   /* –î–æ—â */
                #00FFFF 20% 40%,  /* –°–Ω—ñ–≥ */
                #FF4081 40% 60%,  /* –ì—Ä–∞–¥ */
                #C77DFF 60% 80%,  /* –Ü–Ω—ñ–π */
                #39FF14 80% 100%  /* –†–æ—Å–∞ */
            );
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.4);
        }

        .wheel-arrow {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
            z-index: 10;
        }

        .wheel-labels {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            pointer-events: none;
            font-size: 28px;
        }

        .current-precipitation {
            font-size: 100px;
            margin: 30px 0;
            min-height: 120px;
        }

        .reaction-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 500px;
            margin: 30px auto;
        }

        .reaction-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--glass-border);
            padding: 25px;
            border-radius: 20px;
            font-size: 60px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reaction-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .reaction-btn.correct {
            background: rgba(57, 255, 20, 0.4);
            border-color: var(--accent-lime);
        }

        .reaction-btn.incorrect {
            background: rgba(255, 0, 0, 0.4);
            border-color: #FF0000;
        }

        .timer-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto;
            max-width: 500px;
        }

        .timer-fill {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, var(--accent-lime), var(--accent-cyan));
            transition: width 0.1s linear;
        }

        .quiz-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 900;
            color: var(--accent-cyan);
        }

        #spin-btn {
            padding: 18px 50px;
            font-size: 24px;
            margin: 20px 0;
        }

        .result-screen {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .result-emoji {
            font-size: 100px;
            margin-bottom: 20px;
        }

        .result-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--accent-cyan);
        }
    </style>
</head>
<body>
    <header class="game-header">
        <div class="header-left">
            <a href="../game.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div class="player-info">
                <div class="username">üåßÔ∏è –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ñ –æ–ø–∞–¥–∏</div>
                <div class="player-class">–†—ñ–≤–µ–Ω—å 5</div>
            </div>
        </div>
        <div class="stats">
            <div class="stat-item">
                <i class="fas fa-gamepad"></i>
                <span id="round-display">0/10</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-trophy"></i>
                <span id="score-display">0</span>
            </div>
        </div>
    </header>

    <main class="game-container">
        <div class="quiz-stats">
            <div class="stat-item">
                <div class="stat-value" id="current-round">1</div>
                <div class="stat-label">—Ä–∞—É–Ω–¥</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="correct-count">0</div>
                <div class="stat-label">–≤–¥–∞–ª—ñ —Ä–µ–∞–∫—Ü—ñ—ó</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-score">0</div>
                <div class="stat-label">–±–∞–ª—ñ–≤</div>
            </div>
        </div>

        <!-- –†—É–ª–µ—Ç–∫–∞ -->
        <div class="wheel-container">
            <div class="wheel-arrow">‚ñº</div>
            <div id="wheel"></div>
            <div class="wheel-labels">
                <div>üåßÔ∏è</div>
                <div>‚ùÑÔ∏è</div>
                <div>üßä</div>
                <div>üå´Ô∏è</div>
                <div>üíß</div>
            </div>
        </div>

        <button class="btn-primary" id="spin-btn">–ö—Ä—É—Ç–∏—Ç–∏ —Ä—É–ª–µ—Ç–∫—É! üé∞</button>

        <!-- –ü–æ—Ç–æ—á–Ω–∏–π –æ–ø–∞–¥ -->
        <div class="current-precipitation" id="current-precipitation"></div>

        <!-- –¢–∞–π–º–µ—Ä —Ä–µ–∞–∫—Ü—ñ—ó -->
        <div class="timer-bar" id="reaction-timer" style="display: none;">
            <div class="timer-fill" id="timer-fill"></div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–∞–∫—Ü—ñ—ó -->
        <div class="reaction-buttons" id="reaction-buttons" style="display: none;">
            <button class="reaction-btn" data-reaction="umbrella">‚òî</button>
            <button class="reaction-btn" data-reaction="jacket">üß•</button>
            <button class="reaction-btn" data-reaction="house">üè†</button>
            <button class="reaction-btn" data-reaction="gloves">üß§</button>
        </div>

        <!-- –ï–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ -->
        <div id="result-screen" class="result-screen">
            <div class="result-emoji" id="result-emoji">üéâ</div>
            <h2 id="result-title">–í—ñ—Ç–∞—î–º–æ!</h2>
            <p id="result-message">–í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ä—ñ–≤–µ–Ω—å!</p>
            <div class="result-score" id="final-score">0 –±–∞–ª—ñ–≤</div>
            <p>–ó—ñ—Ä–æ–∫ –æ—Ç—Ä–∏–º–∞–Ω–æ: <span id="stars-earned">0/3</span></p>

            <div style="margin-top: 40px;">
                <button class="btn-primary" onclick="finishLevel()" style="padding: 15px 40px; font-size: 20px;">
                    <i class="fas fa-trophy"></i> –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å
                </button>
            </div>
        </div>
    </main>

    <script>
        // ============ –î–ê–ù–Ü –û–ü–ê–î–Ü–í ============
        const precipitations = [
            { name: "–î–æ—â", emoji: "üåßÔ∏è", correct: "umbrella" },      // ‚òî
            { name: "–°–Ω—ñ–≥", emoji: "‚ùÑÔ∏è", correct: "jacket" },       // üß•
            { name: "–ì—Ä–∞–¥", emoji: "üßä", correct: "house" },         // üè†
            { name: "–Ü–Ω—ñ–π", emoji: "üå´Ô∏è", correct: "gloves" },       // üß§
            { name: "–†–æ—Å–∞", emoji: "üíß", correct: "none" }          // –Ω–µ–º–∞—î –∑–∞—Ö–∏—Å—Ç—É, –ø—Ä–æ—Å—Ç–æ —Ä–∞–¥—ñ—Ç–∏ (–¥–æ–¥–∞–º–æ —Ñ–µ–π–∫–æ–≤—É –∫–Ω–æ–ø–∫—É –∞–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
        ];

        // –î–ª—è —Ä–æ—Å–∏ ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞: –±—É–¥—å-—è–∫–∞ –∫–Ω–æ–ø–∫–∞ –∞–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ +–±–∞–ª–∏
        // –ó—Ä–æ–±–∏–º–æ: —è–∫—â–æ —Ä–æ—Å–∞ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ +10 –±–∞–ª—ñ–≤ –±–µ–∑ –≤–∏–±–æ—Ä—É (—Å—é—Ä–ø—Ä–∏–∑!)

        // ============ –ó–ú–Ü–ù–ù–Ü ============
        let currentRound = 0;
        let score = 0;
        let correctReactions = 0;
        const totalRounds = 10;
        let currentPrecipitation = null;
        let reactionTimeLeft = 0;
        let reactionInterval;

        // ============ –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ============
        function initGame() {
            updateStats();
            document.getElementById('spin-btn').addEventListener('click', spinWheel);
        }

        // ============ –ö–†–£–¢–ò–¢–ò –ö–û–õ–ï–°–û ============
        function spinWheel() {
            if (currentRound >= totalRounds) return;

            const wheel = document.getElementById('wheel');
            const randomDegrees = Math.floor(Math.random() * 3600) + 720; // 2-10 –æ–±–µ—Ä—Ç—ñ–≤
            wheel.style.transform = `rotate(${randomDegrees}deg)`;

            setTimeout(() => {
                // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Å–µ–∫—Ç–æ—Ä (360¬∞ / 5 = 72¬∞ –Ω–∞ —Å–µ–∫—Ç–æ—Ä)
                let rotation = randomDegrees % 360;
                let sector = Math.floor((360 - rotation + 36) / 72) % 5; // +36 –¥–ª—è —Ü–µ–Ω—Ç—Ä—É —Å—Ç—Ä—ñ–ª–∫–∏
                currentPrecipitation = precipitations[sector];

                showPrecipitation();
            }, 4200);
        }

        // ============ –ü–û–ö–ê–ó–ê–¢–ò –û–ü–ê–î ============
        function showPrecipitation() {
            currentRound++;
            updateStats();

            document.getElementById('current-precipitation').textContent = currentPrecipitation.emoji;

            if (currentPrecipitation.name === "–†–æ—Å–∞") {
                // –°—é—Ä–ø—Ä–∏–∑ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–¥–∞–ª–∞ —Ä–µ–∞–∫—Ü—ñ—è
                setTimeout(() => {
                    score += 20; // –±–æ–Ω—É—Å –∑–∞ —Å—é—Ä–ø—Ä–∏–∑
                    correctReactions++;
                    updateStats();
                    showMessage('–†–æ—Å–∞! –ü—Ä–∏—î–º–Ω–∏–π —Ä–∞–Ω–æ–∫ üå∏ +20 –±–∞–ª—ñ–≤!', 'success');
                    nextRound();
                }, 2000);
                return;
            }

            // –ó–≤–∏—á–∞–π–Ω–∞ —Ä–µ–∞–∫—Ü—ñ—è
            document.getElementById('reaction-buttons').style.display = 'grid';
            document.getElementById('reaction-timer').style.display = 'block';
            document.getElementById('timer-fill').style.width = '100%';

            reactionTimeLeft = 50; // 5 —Å–µ–∫—É–Ω–¥ (50 * 100ms)
            reactionInterval = setInterval(updateReactionTimer, 100);

            // –°–ª—É—Ö–∞—á—ñ –Ω–∞ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.reaction-btn').forEach(btn => {
                btn.onclick = () => checkReaction(btn.dataset.reaction);
            });
        }

        // ============ –¢–ê–ô–ú–ï–† –†–ï–ê–ö–¶–Ü–á ============
        function updateReactionTimer() {
            reactionTimeLeft--;
            document.getElementById('timer-fill').style.width = (reactionTimeLeft / 50 * 100) + '%';

            if (reactionTimeLeft <= 0) {
                clearInterval(reactionInterval);
                checkReaction(null); // –Ω–µ –≤—Å—Ç–∏–≥
            }
        }

        // ============ –ü–ï–†–ï–í–Ü–†–ö–ê –†–ï–ê–ö–¶–Ü–á ============
        function checkReaction(chosen) {
            clearInterval(reactionInterval);
            document.getElementById('reaction-buttons').style.display = 'none';
            document.getElementById('reaction-timer').style.display = 'none';

            const isCorrect = chosen === currentPrecipitation.correct;

            if (isCorrect) {
                score += 15 + Math.floor(reactionTimeLeft / 5); // –±–æ–Ω—É—Å –∑–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å
                correctReactions++;
                showMessage('–í–¥–∞–ª–æ! –¢–∏ –≤ –±–µ–∑–ø–µ—Ü—ñ üòé', 'success');
                document.querySelector(`.reaction-btn[data-reaction="${chosen}"]`).classList.add('correct');
            } else {
                showMessage(chosen === null ? '–ù–µ –≤—Å—Ç–∏–≥! üòÖ' : '–ù—ñ, —Ü–µ –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ! üôà', 'info');
                if (chosen) {
                    document.querySelector(`.reaction-btn[data-reaction="${chosen}"]`).classList.add('incorrect');
                }
            }

            updateStats();
            setTimeout(nextRound, 2500);
        }

        // ============ –ù–ê–°–¢–£–ü–ù–ò–ô –†–ê–£–ù–î ============
        function nextRound() {
            document.querySelectorAll('.reaction-btn').forEach(btn => {
                btn.classList.remove('correct', 'incorrect');
            });

            document.getElementById('current-precipitation').textContent = '';

            if (currentRound >= totalRounds) {
                finishGame();
            } else {
                document.getElementById('spin-btn').disabled = false;
            }
        }

        // ============ –û–ù–û–í–õ–ï–ù–ù–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò ============
        function updateStats() {
            document.getElementById('current-round').textContent = currentRound + 1;
            document.getElementById('round-display').textContent = `${currentRound}/${totalRounds}`;
            document.getElementById('correct-count').textContent = correctReactions;
            document.getElementById('total-score').textContent = score;
            document.getElementById('score-display').textContent = score;
        }

        // ============ –ó–ê–í–ï–†–®–ï–ù–ù–Ø –ì–†–ò ============
        function finishGame() {
            document.getElementById('spin-btn').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';

            const percentage = (correctReactions / totalRounds) * 100;
            let stars = 0;
            let emoji = 'üò¢';
            let title = '–ú–æ–∂–Ω–∞ –∫—Ä–∞—â–µ!';
            let message = '–°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑!';

            if (percentage >= 90) {
                stars = 3;
                emoji = 'üèÜ';
                title = '–°—É–ø–µ—Ä!';
                message = '–¢–∏ –º–∞–π—Å—Ç–µ—Ä –æ–ø–∞–¥—ñ–≤!';
            } else if (percentage >= 70) {
                stars = 2;
                emoji = 'üéâ';
                title = '–ß—É–¥–æ–≤–æ!';
                message = '–¢–∏ –¥–æ–±—Ä–µ —Ä–µ–∞–≥—É—î—à!';
            } else if (percentage >= 50) {
                stars = 1;
                emoji = 'üëç';
                title = '–ù–µ–ø–æ–≥–∞–Ω–æ!';
                message = '–¢–∏ –≤–∂–µ –±–∞–≥–∞—Ç–æ –∑–Ω–∞—î—à!';
            }

            document.getElementById('result-emoji').textContent = emoji;
            document.getElementById('result-title').textContent = title;
            document.getElementById('result-message').textContent = message;
            document.getElementById('final-score').textContent = `${score} –±–∞–ª—ñ–≤`;
            document.getElementById('stars-earned').textContent = `${stars}/3`;

            saveResults(score, stars);
        }

        // ============ –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø ============
        function saveResults(finalScore, stars) {
            localStorage.setItem('level5_score', finalScore);
            localStorage.setItem('level5_stars', stars);
            localStorage.setItem('level5_completed', 'true');
        }

        // ============ –ó–ê–í–ï–†–®–ï–ù–ù–Ø –†–Ü–í–ù–Ø ============
        function finishLevel() {
            const score = parseInt(localStorage.getItem('level5_score')) || 0;
            const stars = parseInt(localStorage.getItem('level5_stars')) || 0;
            window.location.href = `../game.html?level=5&score=${score}&stars=${stars}`;
        }

        // ============ –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø ============
        function showMessage(text, type) {
            alert(text); // –º–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –∫—Ä–∞—Å–∏–≤–∏–π toast –ø—ñ–∑–Ω—ñ—à–µ
        }

        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
