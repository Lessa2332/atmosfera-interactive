<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è - –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0F172A;
            color: #E2E8F0;
            font-family: 'Nunito', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container { width: 100%; max-width: 1100px; }
        .welcome-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(16px);
            border-radius: 32px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            position: relative;
        }
        .header-nav {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        .header-nav button {
            background: none;
            border: none;
            color: #00FFFF;
            font-size: 18px;
            cursor: pointer;
            text-shadow: 0 0 10px #00FFFF;
        }
        /* –ï–∫—Ä–∞–Ω –≤—Ö–æ–¥—É */
        #login-screen, #main-content { display: none; }
        #login-screen.active, #main-content.active { display: block; }
        .login-form {
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }
        .login-form input {
            width: 100%;
            padding: 18px;
            margin: 16px 0;
            border-radius: 20px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 20px;
            text-align: center;
        }
        .btn-primary {
            padding: 16px 40px;
            background: linear-gradient(45deg, #00FFFF, #0099FF);
            color: #000;
            font-weight: 900;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 0 30px #00FFFF;
            transition: all 0.3s;
        }
        .btn-primary:hover { transform: scale(1.1); box-shadow: 0 0 50px #00FFFF; }
        /* –í–µ—Å—å —Ç–≤—ñ–π –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∏–ª—å */
        .header h1 { font-size: 48px; font-weight: 900; text-align: center; margin-bottom: 12px; text-shadow: 0 0 20px rgba(0, 255, 255, 0.5); }
        .header .subtitle { font-size: 24px; }
        .content { display: flex; gap: 40px; margin: 40px 0; align-items: center; flex-wrap: wrap; }
        .welcome-image { flex: 1; text-align: center; min-width: 300px; }
        .child-avatar { font-size: 140px; color: #00FFFF; text-shadow: 0 0 30px #00FFFF; margin-bottom: 20px; }
        .science-icons i { font-size: 60px; margin: 12px; animation: float 6s ease-in-out infinite; }
        .science-icons i:nth-child(1) { color: #FFB800; text-shadow: 0 0 30px #FFB800; animation-delay: 0s; }
        .science-icons i:nth-child(2) { color: #00FFFF; text-shadow: 0 0 30px #00FFFF; animation-delay: 0.3s; }
        .science-icons i:nth-child(3) { color: #39FF14; text-shadow: 0 0 30px #39FF14; animation-delay: 0.6s; }
        .science-icons i:nth-child(4) { color: #FF9500; text-shadow: 0 0 30px #FF9500; animation-delay: 0.9s; }
        .welcome-text { flex: 2; }
        .welcome-text h2 { font-size: 36px; font-weight: 900; margin-bottom: 16px; }
        .features { display: flex; gap: 20px; margin: 24px 0; flex-wrap: wrap; }
        .feature { flex: 1; min-width: 180px; background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1); }
        .feature i { font-size: 40px; margin-bottom: 10px; display: block; }
        .feature:nth-child(1) i { color: #00FFFF; text-shadow: 0 0 15px #00FFFF; }
        .feature:nth-child(2) i { color: #FF66CC; text-shadow: 0 0 15px #FF66CC; }
        .feature:nth-child(3) i { color: #FFB800; text-shadow: 0 0 15px #FFB800; }
        .welcome-text ul { list-style: none; margin: 20px 0; }
        .welcome-text li { margin: 12px 0; padding-left: 30px; position: relative; }
        .welcome-text li::before { content: "‚ú¶"; color: #00FFFF; position: absolute; left: 0; text-shadow: 0 0 10px #00FFFF; }
        .start-section { margin-top: 50px; }
        .start-section h3 { font-size: 32px; text-align: center; margin-bottom: 12px; }
        .all-topics { margin-top: 50px; text-align: center; }
        .topics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-top: 24px; }
        .topic-link { --accent: #00FFFF; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 24px; text-decoration: none; color: #E2E8F0; border: 2px solid var(--accent); box-shadow: 0 0 15px var(--accent); transition: all 0.3s ease; }
        .topic-link:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 0 40px var(--accent); }
        .topic-link i { font-size: 56px; color: var(--accent); text-shadow: 0 0 25px var(--accent); margin-bottom: 12px; }
        .accent-orange { --accent: #FF9500; }
        .accent-cyan { --accent: #00FFFF; }
        .accent-lime { --accent: #39FF14; }
        .accent-purple { --accent: #C77DFF; }
        .accent-blue { --accent: #0099FF; }
        .accent-magenta { --accent: #FF66CC; }
        .accent-green { --accent: #32CD32; }
        .footer { text-align: center; margin-top: 50px; opacity: 0.8; }
        .footer .hint { margin-top: 12px; font-size: 18px; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        /* –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ç–∞ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥ */
        .achievements, .leaderboard {
            margin-top: 60px;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(16px);
            padding: 30px;
            border-radius: 28px;
            border: 2px solid #39FF14;
            box-shadow: 0 0 30px rgba(57, 255, 20, 0.4);
        }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: rgba(255,255,255,0.1); padding: 16px; cursor: pointer; text-align: center; font-weight: 900; }
        th:hover { background: rgba(57, 255, 20, 0.3); box-shadow: 0 0 20px #39FF14; }
        td { padding: 14px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        tr:hover { background: rgba(255,255,255,0.05); }
        .stars { font-size: 28px; text-shadow: 0 0 15px #FFB800; }
        
        /* –ù–æ–≤–∏–π –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä */
        .progress-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 20px;
            border: 2px solid #00FFFF;
        }
        
        .progress-bar-container {
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00FFFF, #39FF14);
            border-radius: 12px;
            transition: width 1s ease;
            position: relative;
            width: 0%;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #FFB800;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="welcome-card">
            <!-- –ï–∫—Ä–∞–Ω –≤—Ö–æ–¥—É -->
            <div id="login-screen">
                <h1 style="text-align:center; text-shadow: 0 0 30px #00FFFF;"><i class="fas fa-smile-beam"></i> –î–∞–≤–∞–π –∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—å!</h1>
                <div class="login-form">
                    <p style="font-size:24px; margin-bottom:30px;">–ü—Ä–∏–≤—ñ—Ç, –º–∞–π–±—É—Ç–Ω—ñ–π –≤—á–µ–Ω–∏–π! üöÄ</p>
                    <input type="text" id="user-name" placeholder="–¢–≤–æ—î —ñ–º'—è" required>
                    <input type="text" id="user-class" placeholder="–¢–≤—ñ–π –∫–ª–∞—Å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 5-–ê)" required>
                    <button class="btn-primary" onclick="startLearning()">–†–æ–∑–ø–æ—á–∞—Ç–∏ –ø—Ä–∏–≥–æ–¥—É!</button>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div id="main-content">
                <div class="header-nav">
                    <button onclick="logout()">–í–∏–π—Ç–∏</button>
                </div>
                <div class="header">
                    <h1><i class="fas fa-smile"></i> –ü—Ä–∏–≤—ñ—Ç, <span id="greeting-name"></span>!</h1>
                    <p class="subtitle">–ó <span id="greeting-class"></span> –∫–ª–∞—Å—É. –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ —Å–≤—ñ—Ç—É –¥–∏–≤–æ–≤–∏–∂–Ω–æ—ó –Ω–∞—É–∫–∏!</p>
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä -->
                <div class="progress-section" style="display: none;" id="progress-section">
                    <h3 style="text-align:center; margin-bottom:15px; color:#00FFFF;">
                        <i class="fas fa-chart-line"></i> –¢–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å
                    </h3>
                    <div class="progress-bar-container">
                        <div class="progress-fill" id="global-progress"></div>
                    </div>
                    <div class="progress-info">
                        <span id="progress-text">0% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                        <span id="total-score">0 –±–∞–ª—ñ–≤</span>
                    </div>
                </div>

                <div class="content">
                    <div class="welcome-image">
                        <div class="child-avatar"><i class="fas fa-child"></i></div>
                        <div class="science-icons">
                            <i class="fas fa-sun"></i>
                            <i class="fas fa-cloud"></i>
                            <i class="fas fa-wind"></i>
                            <i class="fas fa-temperature-high"></i>
                        </div>
                    </div>
                    <div class="welcome-text">
                        <h2>–ü—Ä–∏–≤—ñ—Ç, –º–∞–π–±—É—Ç–Ω—ñ–π –≤—á–µ–Ω–∏–π!</h2>
                        <p>–°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –≤—ñ–¥–ø—Ä–∞–≤–∏–º–æ—Å—è —É –∑–∞—Ö–æ–ø–ª—é—é—á—É –ø–æ–¥–æ—Ä–æ–∂ –¥–æ —Å–≤—ñ—Ç—É <strong>–ê–¢–ú–û–°–§–ï–†–ò</strong> - –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ—ó –æ–±–æ–ª–æ–Ω–∫–∏ –Ω–∞—à–æ—ó –ø–ª–∞–Ω–µ—Ç–∏!</p>
                        <div class="features">
                            <div class="feature"><i class="fas fa-play-circle"></i><span>–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —É—Ä–æ–∫–∏</span></div>
                            <div class="feature"><i class="fas fa-gamepad"></i><span>–¶—ñ–∫–∞–≤—ñ —Å–∏–º—É–ª—è—Ü—ñ—ó</span></div>
                            <div class="feature"><i class="fas fa-lightbulb"></i><span>–ü—Ä–æ—Å—Ç—ñ –ø–æ—è—Å–Ω–µ–Ω–Ω—è</span></div>
                        </div>
                        <p>–¢–∏ –¥—ñ–∑–Ω–∞—î—à—Å—è:</p>
                        <ul>
                            <li>–ß–æ–º—É –∑–º—ñ–Ω—é—î—Ç—å—Å—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–¥–µ–Ω—å</li>
                            <li>–Ø–∫ —É—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —Ö–º–∞—Ä–∏ —Ç–∞ –≤—ñ—Ç–µ—Ä</li>
                            <li>–©–æ —Ç–∞–∫–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∏–π —Ç–∏—Å–∫</li>
                            <li>–Ø–∫ –ø—Ä–∞—Ü—é—î –ø–∞—Ä–Ω–∏–∫–æ–≤–∏–π –µ—Ñ–µ–∫—Ç</li>
                        </ul>
                    </div>
                </div>

                <div class="start-section">
                    <h3>–ì–æ—Ç–æ–≤–∏–π —Ä–æ–∑–ø–æ—á–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è?</h3>
                    <p style="text-align:center; opacity:0.9; margin-bottom:40px;">–û–±–µ—Ä–∏ –±—É–¥—å-—è–∫—É —Ç–µ–º—É, –∑ —è–∫–æ—ó —Ö–æ—á–µ—à –ø–æ—á–∞—Ç–∏:</p>
                    <div class="all-topics">
                        <div class="topics-grid">
                            <a href="atmosphere.html" class="topic-link accent-orange"><i class="fas fa-sun"></i> –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</a>
                            <a href="page2.html" class="topic-link accent-cyan"><i class="fas fa-cloud"></i> –•–º–∞—Ä–∏</a>
                            <a href="page3.html" class="topic-link accent-lime"><i class="fas fa-wind"></i> –í—ñ—Ç–µ—Ä</a>
                            <a href="page4.html" class="topic-link accent-purple"><i class="fas fa-tachometer-alt"></i> –¢–∏—Å–∫</a>
                            <a href="page5.html" class="topic-link accent-blue"><i class="fas fa-umbrella"></i> –û–ø–∞–¥–∏</a>
                            <a href="page6.html" class="topic-link accent-magenta"><i class="fas fa-layer-group"></i> –®–∞—Ä–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∏</a>
                            <a href="page7.html" class="topic-link accent-green"><i class="fas fa-seedling"></i> –ü–∞—Ä–Ω–∏–∫–æ–≤–∏–π –µ—Ñ–µ–∫—Ç</a>
                        </div>
                    </div>
                </div>

                <!-- –û—Å–æ–±–∏—Å—Ç—ñ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è -->
                <div class="achievements">
                    <h2 style="text-align:center; margin-bottom:20px;">–ú–æ—ó –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è üåü</h2>
                    <div id="personal-loading" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ—Å—è–≥–Ω–µ–Ω—å</div>
                    <table id="personal-table" style="display: none;">
                        <thead><tr><th>–¢–µ–º–∞</th><th>–ë–∞–ª–∏</th><th>–ù–∞–ª—ñ–ø–∫–∏</th></tr></thead>
                        <tbody id="personal-scores"></tbody>
                    </table>
                </div>

                <!-- –õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –∫–ª–∞—Å—É -->
                <div class="leaderboard">
                    <h2 style="text-align:center; margin-bottom:20px; text-shadow: 0 0 20px #39FF14;">–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –∫–ª–∞—Å—É üèÜ</h2>
                    <div style="text-align:center; margin-bottom:20px;">
                        <button class="btn-primary" onclick="loadLeaderboard(true)">
                            <i class="fas fa-sync-alt"></i> –û–Ω–æ–≤–∏—Ç–∏ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥
                        </button>
                    </div>
                    <div id="leaderboard-loading" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥–µ—Ä—ñ–≤</div>
                    <div class="table-container" id="leaderboard-container" style="display: none;">
                        <table id="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>–Ü–º'—è</th>
                                    <th>–ö–ª–∞—Å</th>
                                    <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
                                    <th>–•–º–∞—Ä–∏</th>
                                    <th>–í—ñ—Ç–µ—Ä</th>
                                    <th>–¢–∏—Å–∫</th>
                                    <th>–û–ø–∞–¥–∏</th>
                                    <th style="color:#39FF14;">–í—Å—å–æ–≥–æ üîÆ</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="footer">
                    <p>–°—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Ü—ñ–∫–∞–≤–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è –¥—ñ—Ç–µ–π</p>
                    <p class="hint">üëÜ –ù–∞—Ç–∏—Å–∫–∞–π –Ω–∞ –∫–Ω–æ–ø–∫–∏, —â–æ–± –ø–µ—Ä–µ–π—Ç–∏ –¥–æ —É—Ä–æ–∫—ñ–≤!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –í–ò–ö–û–†–ò–°–¢–û–í–£–Ñ–ú–û –í–ê–® –ù–û–í–ò–ô URL
        const SHEET_URL = 'https://script.google.com/macros/s/AKfycbwQTDZFGpxje9jVN2FpUy-nmPJNf0CcCvSslOsQambXS7Qw-fT1WP0LimOcyrdd19ioFQ/exec';
        
        let userData = JSON.parse(localStorage.getItem('atmosphereUser')) || {};
        let scores = userData.scores || { 
            temperature: 0, 
            clouds: 0, 
            wind: 0, 
            pressure: 0, 
            precipitation: 0, 
            layers: 0, 
            greenhouse: 0 
        };

        function startLearning() {
            const name = document.getElementById('user-name').value.trim();
            const userClass = document.getElementById('user-class').value.trim();
            
            if (!name || !userClass) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω–∏ —Å–≤–æ—î —ñ–º\'—è —Ç–∞ –∫–ª–∞—Å! ‚úèÔ∏è');
                return;
            }
            
            userData.name = name;
            userData.class = userClass;
            userData.scores = scores;
            localStorage.setItem('atmosphereUser', JSON.stringify(userData));
            
            // –î–æ–¥–∞—î–º–æ –Ω–µ–≤–µ–ª–∏–∫—É –∞–Ω—ñ–º–∞—Ü—ñ—é
            document.getElementById('login-screen').style.opacity = '0.7';
            setTimeout(() => {
                showMainContent();
                document.getElementById('login-screen').style.opacity = '1';
            }, 300);
        }

        function showMainContent() {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('main-content').classList.add('active');
            document.getElementById('greeting-name').textContent = userData.name;
            document.getElementById('greeting-class').textContent = userData.class;
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –±–∞–ª–∏
            const hasProgress = Object.values(scores).some(score => score > 0);
            if (hasProgress) {
                document.getElementById('progress-section').style.display = 'block';
                updateProgressBar();
            }
            
            updatePersonalScores();
            loadLeaderboard();
        }

        function logout() {
            if (confirm('–í–∏–π—Ç–∏ –∑ –∞–∫–∫–∞—É–Ω—Ç–∞ —ñ –∑–º—ñ–Ω–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞? üëã')) {
                localStorage.removeItem('atmosphereUser');
                location.reload();
            }
        }

        function updateProgressBar() {
            const totalThemes = 7;
            const completedThemes = Object.values(scores).filter(score => score > 0).length;
            const progressPercent = Math.round((completedThemes / totalThemes) * 100);
            
            const totalScore = Object.values(scores).reduce((sum, score) => sum + score, 0);
            
            document.getElementById('global-progress').style.width = progressPercent + '%';
            document.getElementById('progress-text').textContent = `${progressPercent}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ (${completedThemes}/${totalThemes} —Ç–µ–º)`;
            document.getElementById('total-score').textContent = `${totalScore} –±–∞–ª—ñ–≤`;
        }

        async function updatePersonalScores() {
            try {
                // –°–ø–æ—á–∞—Ç–∫—É —Ö–æ–≤–∞—î–º–æ —Ç–∞–±–ª–∏—Ü—é —ñ –ø–æ–∫–∞–∑—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                document.getElementById('personal-table').style.display = 'none';
                document.getElementById('personal-loading').style.display = 'block';
                
                // –û—Ç—Ä–∏–º—É—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–∞–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch(`${SHEET_URL}?action=getUserData&name=${encodeURIComponent(userData.name)}&class=${encodeURIComponent(userData.class)}`);
                
                if (!response.ok) {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
                const result = await response.json();
                
                if (result.status === 'success' && result.data) {
                    // –û–Ω–æ–≤–ª—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω—ñ –±–∞–ª–∏ –∑ —Å–µ—Ä–≤–µ—Ä–∞
                    const serverData = result.data;
                    scores = {
                        temperature: parseInt(serverData[2]) || 0,
                        clouds: parseInt(serverData[3]) || 0,
                        wind: parseInt(serverData[4]) || 0,
                        pressure: parseInt(serverData[5]) || 0,
                        precipitation: parseInt(serverData[6]) || 0,
                        layers: parseInt(serverData[7]) || 0,
                        greenhouse: parseInt(serverData[8]) || 0
                    };
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ userData
                    userData.scores = scores;
                    localStorage.setItem('atmosphereUser', JSON.stringify(userData));
                }
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                const tbody = document.getElementById('personal-scores');
                tbody.innerHTML = '';
                
                const themes = [
                    { key: 'temperature', name: 'üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞' },
                    { key: 'clouds', name: '‚òÅÔ∏è –•–º–∞—Ä–∏' },
                    { key: 'wind', name: 'üí® –í—ñ—Ç–µ—Ä' },
                    { key: 'pressure', name: 'üìä –¢–∏—Å–∫' },
                    { key: 'precipitation', name: 'üåßÔ∏è –û–ø–∞–¥–∏' },
                    { key: 'layers', name: 'üõ∞Ô∏è –®–∞—Ä–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∏' },
                    { key: 'greenhouse', name: 'üåø –ü–∞—Ä–Ω–∏–∫–æ–≤–∏–π –µ—Ñ–µ–∫—Ç' }
                ];
                
                let total = 0;
                
                themes.forEach(theme => {
                    const value = scores[theme.key] || 0;
                    total += value;
                    
                    // –í–∏–∑–Ω–∞—á–∞—î–º–æ –Ω–∞–ª—ñ–ø–∫–∏ –∑–∞ –±–∞–ª–∏
                    let stars = '';
                    if (value >= 40) stars = '‚≠ê‚≠ê‚≠ê';
                    else if (value >= 25) stars = '‚≠ê‚≠ê‚òÜ';
                    else if (value >= 10) stars = '‚≠ê‚òÜ‚òÜ';
                    else if (value > 0) stars = '‚òÜ';
                    
                    tbody.innerHTML += `
                        <tr>
                            <td style="text-align: left; padding-left: 20px;">
                                <i class="fas fa-${getThemeIcon(theme.key)}" style="margin-right: 10px; color: ${getThemeColor(theme.key)}"></i>
                                ${theme.name}
                            </td>
                            <td style="font-weight: bold; color: ${getScoreColor(value)}">${value}</td>
                            <td class="stars">${stars}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML += `
                    <tr style="background: rgba(57, 255, 20, 0.1); font-weight:900;">
                        <td style="text-align: left; padding-left: 20px;">üéØ –í—Å—å–æ–≥–æ</td>
                        <td style="color: #39FF14;">${total}</td>
                        <td></td>
                    </tr>
                `;
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä
                updateProgressBar();
                
                // –•–æ–≤–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ –ø–æ–∫–∞–∑—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é
                document.getElementById('personal-loading').style.display = 'none';
                document.getElementById('personal-table').style.display = 'table';
                
            } catch (err) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ—Å—è–≥–Ω–µ–Ω—å:', err);
                document.getElementById('personal-loading').innerHTML = 
                    '‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ —è–∫ –∑–∞–ø–∞—Å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
                showLocalPersonalScores();
            }
        }

        function showLocalPersonalScores() {
            const tbody = document.getElementById('personal-scores');
            tbody.innerHTML = '';
            
            const themes = [
                { key: 'temperature', name: 'üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞' },
                { key: 'clouds', name: '‚òÅÔ∏è –•–º–∞—Ä–∏' },
                { key: 'wind', name: 'üí® –í—ñ—Ç–µ—Ä' },
                { key: 'pressure', name: 'üìä –¢–∏—Å–∫' },
                { key: 'precipitation', name: 'üåßÔ∏è –û–ø–∞–¥–∏' },
                { key: 'layers', name: 'üõ∞Ô∏è –®–∞—Ä–∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∏' },
                { key: 'greenhouse', name: 'üåø –ü–∞—Ä–Ω–∏–∫–æ–≤–∏–π –µ—Ñ–µ–∫—Ç' }
            ];
            
            let total = 0;
            
            themes.forEach(theme => {
                const value = scores[theme.key] || 0;
                total += value;
                
                let stars = '';
                if (value >= 40) stars = '‚≠ê‚≠ê‚≠ê';
                else if (value >= 25) stars = '‚≠ê‚≠ê‚òÜ';
                else if (value >= 10) stars = '‚≠ê‚òÜ‚òÜ';
                else if (value > 0) stars = '‚òÜ';
                
                tbody.innerHTML += `
                    <tr>
                        <td style="text-align: left; padding-left: 20px;">
                            <i class="fas fa-${getThemeIcon(theme.key)}" style="margin-right: 10px; color: ${getThemeColor(theme.key)}"></i>
                            ${theme.name}
                        </td>
                        <td style="font-weight: bold; color: ${getScoreColor(value)}">${value}</td>
                        <td class="stars">${stars}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML += `
                <tr style="background: rgba(57, 255, 20, 0.1); font-weight:900;">
                    <td style="text-align: left; padding-left: 20px;">üéØ –í—Å—å–æ–≥–æ</td>
                    <td style="color: #39FF14;">${total}</td>
                    <td></td>
                </tr>
            `;
            
            document.getElementById('personal-loading').style.display = 'none';
            document.getElementById('personal-table').style.display = 'table';
        }

        async function loadLeaderboard(forceRefresh = false) {
            try {
                // –ü–æ–∫–∞–∑—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                document.getElementById('leaderboard-loading').style.display = 'block';
                document.getElementById('leaderboard-container').style.display = 'none';
                
                // –î–æ–¥–∞—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä cache busting –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                const url = forceRefresh ? 
                    `${SHEET_URL}?action=getLeaderboard&t=${Date.now()}` :
                    `${SHEET_URL}?action=getLeaderboard`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥');
                }
                
                const result = await response.json();
                
                if (result.status === 'success' && result.leaderboard) {
                    displayLeaderboard(result.leaderboard);
                } else {
                    throw new Error('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö');
                }
                
            } catch (err) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª—ñ–¥–µ—Ä–±–æ—Ä–¥—É:', err);
                document.getElementById('leaderboard-loading').innerHTML = 
                    '‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
            }
        }

        function displayLeaderboard(data) {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            
            if (!data || data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 30px;">
                            <i class="fas fa-trophy" style="font-size: 40px; color: #FFB800; margin-bottom: 15px; display: block;"></i>
                            <p style="font-size: 18px;">–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –ø–æ—Ä–æ–∂–Ω—ñ–π!</p>
                            <p style="opacity: 0.8;">–°—Ç–∞–Ω—å –ø–µ—Ä—à–∏–º, —Ö—Ç–æ –ø—Ä–æ–π–¥–µ —É—Ä–æ–∫–∏! üöÄ</p>
                        </td>
                    </tr>
                `;
            } else {
                data.forEach((row, index) => {
                    if (!row[0]) return;
                    
                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                    const medal = index < 3 ? medals[index] : `#${index + 1}`;
                    
                    // –û–±—á–∏—Å–ª—é—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É —Å—É–º—É –±–∞–ª—ñ–≤
                    const total = (parseInt(row[2]) || 0) + 
                                  (parseInt(row[3]) || 0) + 
                                  (parseInt(row[4]) || 0) + 
                                  (parseInt(row[5]) || 0) + 
                                  (parseInt(row[6]) || 0) + 
                                  (parseInt(row[7]) || 0) + 
                                  (parseInt(row[8]) || 0);
                    
                    // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    const isCurrentUser = row[0] === userData.name && row[1] === userData.class;
                    const rowClass = isCurrentUser ? 'current-user' : '';
                    
                    tbody.innerHTML += `
                        <tr class="${rowClass}" ${isCurrentUser ? 'style="background: rgba(0, 255, 255, 0.1); border-left: 4px solid #00FFFF;"' : ''}>
                            <td style="font-weight: bold; font-size: 20px;">${medal}</td>
                            <td>${isCurrentUser ? 'üëâ ' : ''}${row[0]}</td>
                            <td>${row[1]}</td>
                            <td>${row[2] || 0}</td>
                            <td>${row[3] || 0}</td>
                            <td>${row[4] || 0}</td>
                            <td>${row[5] || 0}</td>
                            <td>${row[6] || 0}</td>
                            <td style="color: #39FF14; font-weight: 900; font-size: 18px;">${total}</td>
                        </tr>
                    `;
                });
            }
            
            // –•–æ–≤–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ –ø–æ–∫–∞–∑—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é
            document.getElementById('leaderboard-loading').style.display = 'none';
            document.getElementById('leaderboard-container').style.display = 'block';
            
            // –î–æ–¥–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
            if (document.querySelector('.current-user')) {
                document.querySelector('.current-user').style.animation = 'pulse 2s';
                setTimeout(() => {
                    if (document.querySelector('.current-user')) {
                        document.querySelector('.current-user').style.animation = '';
                    }
                }, 2000);
            }
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function getThemeIcon(themeKey) {
            const icons = {
                temperature: 'temperature-high',
                clouds: 'cloud',
                wind: 'wind',
                pressure: 'tachometer-alt',
                precipitation: 'umbrella',
                layers: 'layer-group',
                greenhouse: 'seedling'
            };
            return icons[themeKey] || 'question-circle';
        }

        function getThemeColor(themeKey) {
            const colors = {
                temperature: '#FF9500',
                clouds: '#00FFFF',
                wind: '#39FF14',
                pressure: '#C77DFF',
                precipitation: '#0099FF',
                layers: '#FF66CC',
                greenhouse: '#32CD32'
            };
            return colors[themeKey] || '#FFFFFF';
        }

        function getScoreColor(score) {
            if (score >= 40) return '#39FF14';
            if (score >= 25) return '#FFB800';
            if (score >= 10) return '#00FFFF';
            if (score > 0) return '#C77DFF';
            return '#888888';
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        if (userData.name) {
            document.getElementById('main-content').classList.add('active');
            showMainContent();
        } else {
            document.getElementById('login-screen').classList.add('active');
        }

        // –î–æ–¥–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é pulse –¥–ª—è CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.02); }
                100% { transform: scale(1); }
            }
            .current-user {
                animation: pulse 2s infinite;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            #leaderboard-container table {
                animation: fadeIn 0.5s ease-out;
            }
        `;
        document.head.appendChild(style);

        // –î–æ–¥–∞—î–º–æ hover –µ—Ñ–µ–∫—Ç–∏
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.topic-link').forEach(el => {
                el.addEventListener('mouseover', () => {
                    el.style.transform = 'translateY(-10px) scale(1.05)';
                    el.style.transition = 'all 0.3s ease';
                });
                el.addEventListener('mouseout', () => {
                    el.style.transform = 'translateY(0) scale(1)';
                });
            });
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ–¥–µ—Ä–±–æ—Ä–¥—É –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (userData.name) {
                loadLeaderboard();
            }
        }, 30000);
    </script>
</body>
</html>
